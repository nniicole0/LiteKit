{ Project:  SensorControl.spin Platform: Parallax Project USB Board Revision: 1.2 Author: Nicole Ooi Date: 29 November 2021 Log:Date: Desc}CON        _clkmode = xtal1 + pll16x                                               'Standard clock mode * crystal frequency = 80 MHz        _xinfreq = 5_000_000        '' [ Declare Pins for Sensors ]        'Ultrasonic 1 (Front) - I2C Bus 1        ultra1SCL = 6        ultra1SDA = 7        'Ultrasonic 2 (Back) - I2C        ultra2SCL = 8        ultra2SDA = 9        ' ToF 1 (Front) - I2C Bus 3        tof1SCL = 0        tof1SDA = 1        tof1RST = 14        'ToF 2 (Back) - I2C Bus 4        tof2SCL = 2        tof2SDA = 3        tof2RST = 15        tofAdd = $29VAR  long  cogIDNum, cogStack[128]  long  _Ms_001OBJ  'Term  : "FullDuplexSerial.spin"   'UART communication for debugging  'Ultra  : "EE-7_Ultra_v2.spin"      '<-- Embedded a 2-element obj within EE-7_Ultra_v2  Ultra  : "EE-7_Ultra.spin"  ToF[2] : "EE-7_ToF.spin"  ' Create a hardware definition filePUB Start(mainMSVal, mainToF1Add, mainTof2Add, mainUltra1Add,mainUltra2Add)  _Ms_001 := mainMSVal  Stop  cogIDNum := cognew(sensorCore(mainToF1Add, mainTof2Add, mainUltra1Add, mainUltra2Add), @cogStack)  Pause(2000)  returnPUB Stop  if cogIDNum    cogstop(cogIDNum~)PUB sensorCore(mainToF1Add, mainTof2Add, mainUltra1Add, mainUltra2Add)   | ultraSensor1, ultraSensor2  tofInit  'Perform init for both ToF sensors  'Run & get readings  repeat    Pause(100)    Ultra.Init(ultra1SCL, ultra1SDA)    ultraSensor1 := Ultra.readSensor    long[mainUltra1Add] := ultraSensor1   'Reading from first element obj    Ultra.Init(ultra2SCL, ultra2SDA)    ultraSensor2 := Ultra.readSensor    long[mainUltra2Add] := ultraSensor2   'Reading from second element obj    long[mainToF1Add]   := ToF[0].GetSingleRange(tofAdd)    long[mainToF2Add]   := ToF[1].GetSingleRange(tofAdd)    Pause(100)PRI tofInit | i{{ }}  ToF[0].Init(tof1SCL, tof1SDA, tof1RST)  ToF[0].ChipReset(1)   'Last state is ON position  Pause(1000)  ToF[0].FreshReset(tofAdd)  ToF[0].MandatoryLoad(tofAdd)  ToF[0].RecommendedLoad(tofAdd)  ToF[0].FreshReset(tofAdd)  ToF[1].Init(tof2SCL, tof2SDA, tof2RST)  ToF[1].ChipReset(1)   'Last state is ON position  Pause(1000)  ToF[1].FreshReset(tofAdd)  ToF[1].MandatoryLoad(tofAdd)  ToF[1].RecommendedLoad(tofAdd)  ToF[1].FreshReset(tofAdd)  returnPRI Pause(ms) | t  t := cnt - 1088               'sync with system counter  repeat (ms #> 0)              'delay must be > 0    waitcnt(t += _Ms_001)  returnDATname    byte  "string_data",0